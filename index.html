<!DOCTYPE HTML>
<!--
	Fractal by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Compound Protocol</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<div class="content">
					<h1><a href="https://compound.finance/">Compound</a></h1>
					<p>Follow the steps below to start using<br />
					Compound protocol</a></p>
					<ul class="actions">
						<li><a href="#" onclick="connectWallet()" class="button icon solid fa-chevron-right">1. Connect wallet</a></li>
						<li><a href="#supply" class="button icon solid fa-chevron-down scrolly">2. Supply</a></li>
						<li><a href="#borrow" class="button icon solid fa-chevron-down scrolly">3. Borrow</a></li>
					</ul>
					<div class="col-12">
						<span align="left">
							<label id="walletMsg"></label>
							<label id="networkMsg"></label>
						</span>
					</div>

					<div class="innner table-wrapper">
						<table id="supplyTable">
							<thead><tr><th>Supply Token</th><th>Amount</th></tr></thead>
							<tbody align="left" ></tbody>
							<tfoot><tr><td></td><td id="total_collatoral"></td></tr></tfoot>
						</table>
					</div>

					<div class="innner table-wrapper">
						<table id="borrowTable">
							<thead><tr><th>Borrow Token</th><th>Amount</th></tr></thead>
							<tbody align="left" ></tbody>
							<tfoot><tr><td></td><td id="total_borrow"></td></tr></tfoot>
						</table>
					</div>


				</div>
				<div class="image phone"><div class="inner"><img src="images/screen.jpg" alt="" /></div></div>
			</header>

		<!-- One -->
			<section id="supply" class="wrapper">
				<div class="inner">
					<section>						  
							<div class="row gtr-uniform">		
									<div class="col-12">	
										<h4>Supply token to the Compound Protocol:</h4>	
									</div>
									<div class="col-3 col-12-xsmall">
										<select name="category" id="supplyTokenChoice">
											<option value="">Pick a token</option>
											<option value="ETH" selected>ETH</option>
											<option value="USDC">USDC</option>
											<option value="DAI">DAI</option>
											<option value="UNI">UNI</option>
											<option value="WBTC">WBTC</option>
											<option value="USDT">USDT</option>
											<option value="ZRX">ZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="text" id="supplyAmount" value placeholder="supply amount" />																			
									</div>
									<div class="col-3 col-12-xsmall">
										<input type="submit" id="supplyButton" value="Supply" />
									</div>

									<div class="col-12">
										<label id="supplyMsg"></label>
									</div>

									<div class="col-12">	
										<h4>Redeem from the Compound Protocol:</h4>	
									</div>

									<div class="col-3 col-12-xsmall">
										<select name="category" id="redeemTokenChoice">
											<option value="">Pick a token</option>
											<option value="cETH" selected>cETH</option>
											<option value="cUSDC">cUSDC</option>
											<option value="cDAI">cDAI</option>
											<option value="cUNI">cUNI</option>
											<option value="cWBTC">cWBTC</option>
											<option value="cUSDT">cUSDT</option>
											<option value="cZRX">cZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="text" id="redeemAmount" value placeholder="redeem amount" />																			
									</div>
									<div class="col-3 col-12-xsmall">
										<input type="submit" id="redeemButton" value="Redeem" />
									</div>

									<div class="col-12">
										<label id="redeemMsg"></label>
									</div>

						  </div>
					</section>								
				</div>
			</section>

		<!-- Two -->
			<section id="borrow" class="wrapper">
				<div class="inner">
					<section>
						<div class="row gtr-uniform">	
									<div class="col-12">	
										<h4>1. Enter market (Collateral from supply required):</h4>	
									</div>
									<div class="col-3 col-12-xsmall">
										<select name="category" id="enterTokenChoice">
											<option value="">Pick a token</option>
											<option value="ETH" selected>ETH</option>
											<option value="USDC">USDC</option>
											<option value="DAI">DAI</option>
											<option value="UNI">UNI</option>
											<option value="WBTC">WBTC</option>
											<option value="USDT">USDT</option>
											<option value="ZRX">ZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="submit" id="enterButton" value="Enter Market" />
									</div>
									<div class="col-12">
										<label id="enterMsg"></label>
									</div>

									<!--Borrow -->
									<div class="col-12">	
										<h4>2. Borrow from the Compound Protocol:</h4>	
									</div>
									<div class="col-3 col-12-xsmall">
										<select name="category" id="borrowTokenChoice">
											<option value="">Pick a token</option>
											<option value="ETH" selected>ETH</option>
											<option value="USDC">USDC</option>
											<option value="DAI">DAI</option>
											<option value="UNI">UNI</option>
											<option value="WBTC">WBTC</option>
											<option value="USDT">USDT</option>
											<option value="ZRX">ZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="text" id="borrowAmount" />																			
									</div>
									<div class="col-3 col-12-xsmall">
										<input type="submit" id="borrowButton" value="Borrow" />
									</div>

									<div class="col-12">
										<label id="borrowMsg"></label>
									</div>

									<!--Repay Borrow -->
									<div class="col-12">	
										<h4>3. Repay borrow:</h4>	
									</div>
									<div class="col-3 col-12-xsmall">
										<select name="category" id="repayBorrowTokenChoice">
											<option value="">Pick a token</option>
											<option value="ETH" selected>ETH</option>
											<option value="USDC">USDC</option>
											<option value="DAI">DAI</option>
											<option value="UNI">UNI</option>
											<option value="WBTC">WBTC</option>
											<option value="USDT">USDT</option>
											<option value="ZRX">ZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="text" id="repayBorrowAmount" />
									</div>
									<div class="col-3 col-12-xsmall">
										<input type="submit" id="repayBorrowButton" value="Repay Borrow" />
									</div>

									<div class="col-12">
										<label id="repayMsg"></label>
									</div>

									<div class="col-12">	
										<h4>4. Exit market:</h4>	
									</div>
									<div class="col-3 col-12-xsmall">
										<select name="category" id="exitTokenChoice">
											<option value="">Pick a token</option>
											<option value="ETH" selected>ETH</option>
											<option value="USDC">USDC</option>
											<option value="DAI">DAI</option>
											<option value="UNI">UNI</option>
											<option value="WBTC">WBTC</option>
											<option value="USDT">USDT</option>
											<option value="ZRX">ZRX</option>
										</select>
									</div>

									<div class="col-3 col-12-xsmall">
										<input type="submit" id="exitButton" value="Exit Market" />
									</div>
									<div class="col-12">
										<label id="exitMsg"></label>
									</div>									
						</div>
					</section>
				</div>
			</section>


		<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
					<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
				</ul>
				<p class="copyright">&copy; Untitled. Credits</p>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@compound-finance/compound-js@0.2.0/dist/browser/compound.min.js"></script>

			<script type="text/javascript">		
				var provider=window.ethereum;
				var walletAddress=null;
				var networkName=null;
				var total_borrow_value_in_eth=0;
				var total_collateral_value_in_eth=0;
				var borrowToken = {};
				var supplyToken = {};

				function connectWallet() {	
					document.getElementById('walletMsg').innerHTML = 'Waiting for wallet connection ...';									
					provider.enable().then( function(result) {
						walletAddress = result[0];						
						document.getElementById('walletMsg').innerHTML = 'Wallet address: ' + walletAddress;
						enableButtons();
						console.log(walletAddress);
						networkName=Compound.util.getNetNameWithChainId(parseInt(provider.chainId));
						document.getElementById('networkMsg').innerHTML = 'Ethereum network: ' + networkName;
						console.log(networkName);

						var tokenmap = getAccountInfo();
						console.log(tokenmap);
					});					
				}

				function enableButtons() {
				  const supplyButton = document.getElementById('supplyButton');
				  const redeemButton = document.getElementById('redeemButton');
				  const enterButton = document.getElementById('enterButton');
				  const exitButton = document.getElementById('exitButton');
				  const repayBorrowButton = document.getElementById('repayBorrowButton');

				  //const provider = window.ethereum;
				  provider.enable().then(() => {
				    const compound = new Compound(provider);
						var compoundTokenMap = {
						  "ETH": Compound.ETH,
						  "cETH": Compound.cETH,
						  "DAI": Compound.DAI,
						  "cDAI": Compound.cDAI,
						  "cUSDC": Compound.cUSDC,
						  "cUNI": Compound.cUNI,
						  "cWBTC": Compound.cWBTC,
						  "cUSDT": Compound.cUSDT,
						  "cZRX": Compound.cZRX,
						  "USDC": Compound.USDC,
						  "UNI": Compound.UNI,
						  "WBTC": Compound.WBTC,
						  "USDT": Compound.USDT,
						  "ZRX": Compound.ZRX			  
						};

				    const doEnter = async () => {			
				    	const enterTokenName = document.getElementById('enterTokenChoice').value;
				      const trx = await compound.enterMarkets(compoundTokenMap[enterTokenName]); // Use [] for multiple
				      await trx.wait(1);
	  					console.log('transaction object', trx);
				    };
				    enterButton.onclick = doEnter;

				    const doExit = async () => {			
				    	const exitTokenName = document.getElementById('exitTokenChoice').value;
				      const trx = await compound.exitMarkets(compoundTokenMap[enterTokenName]); // Use [] for multiple
				      await trx.wait(1);
	  					console.log('transaction object', trx);
				    };
				    enterButton.onclick = doEnter;

				    const doSupply = async () => {			
				      const tokenToSupply = document.getElementById('supplyAmount');
				      const supplyTokenName = document.getElementById('supplyTokenChoice').value;
				      console.log('tokenToSupply', tokenToSupply);
				      const trx = await compound.supply(compoundTokenMap[supplyTokenName], tokenToSupply.value);
				      document.getElementById('supplyMsg').innerHTML = 'Waiting for confirmation ...';
				      await trx.wait(1);				    
				      document.getElementById('supplyMsg').innerHTML = 'Supply success';
				      console.log('trx', trx);
				    };
				    supplyButton.onclick = doSupply;
					

				    const doRedeem = async () => {
				      const tokenToRedeem = document.getElementById('redeemAmount');
				      const redeemTokenName = document.getElementById('redeemTokenChoice').value;
				      console.log('tokenToRedeem', compoundTokenMap[redeemTokenName]);
				      const trx = await compound.redeem(compoundTokenMap[redeemTokenName], tokenToRedeem.value);
				      document.getElementById('redeemMsg').innerHTML = 'Waiting for confirmation ...';
				      await trx.wait(1);				    
				      document.getElementById('redeemMsg').innerHTML = 'Reedem success';
				      console.log('trx', trx);
				    };
				    redeemButton.onclick = doRedeem;
					

						const doBorrow = async () => {
				      const tokenToBorrow = document.getElementById('borrowAmount');
				      const borrowTokenName = document.getElementById('borrowTokenChoice').value;
				      const trx = await compound.borrow(compoundTokenMap[borrowTokenName], tokenToBorrow.value);
				      document.getElementById('borrowMsg').innerHTML = 'Waiting for confirmation ...';
				      await trx.wait(1);				    
				      document.getElementById('borrowMsg').innerHTML = 'Borrow success';
				      console.log('trx', trx);
				    };
				    borrowButton.onclick = doBorrow;

						const doRepayBorrow = async () => {
							const tokenToRepay = document.getElementById('repayBorrowAmount');	
							const repayBorrowTokenName = document.getElementById('repayBorrowTokenChoice').value;					
						  const trx = await compound.repayBorrow(compoundTokenMap[repayBorrowTokenName], tokenToRepay.value, null);
				      document.getElementById('repayMsg').innerHTML = 'Waiting for confirmation ...';
				      await trx.wait(1);				    
				      document.getElementById('repayMsg').innerHTML = 'Repay Borrow success';
				      console.log('trx', trx);
				    };
				    repayBorrowButton.onclick = doRepayBorrow;
				    
				  });
				}

				function getAccountInfo() {
					(async function() {
					  const account = await Compound.api.account({
					    "addresses": walletAddress,
					    "network": networkName
					  });
					  
					  if (Object.isExtensible(account) && account.accounts) {
					    account.accounts.forEach((acc) => {
					    	total_borrow_value_in_eth = acc.total_borrow_value_in_eth.value;
					    	total_collateral_value_in_eth = acc.total_collateral_value_in_eth.value;					    	

					      acc.tokens.forEach((tok) => {
					      	val = tok.borrow_balance_underlying.value;
					      	if (val>0.001) {
					      		//console.log(tok.symbol, val);
					      		borrowToken[tok.symbol] = val;
					      		var table = document.getElementById("borrowTable").getElementsByTagName('tbody')[0];
					      		var row = table.insertRow(0);
					      		var cell1 = row.insertCell(0);
					      		var cell2 = row.insertCell(1);

					      		cell1.innerHTML = tok.symbol;
					      		cell2.innerHTML = Math.round(val*100)/100;
					      	}	
					      	val2 = tok.supply_balance_underlying.value;
					      	if (val2>0.001) {
					      		supplyToken[tok.symbol] = val2;
					      		var table = document.getElementById("supplyTable").getElementsByTagName('tbody')[0];
					      		var row = table.insertRow(0);
					      		var cell1 = row.insertCell(0);
					      		var cell2 = row.insertCell(1);

					      		cell1.innerHTML = tok.symbol;
					      		cell2.innerHTML = Math.round(val2*100)/100;

					      	}
					      });
					    });
					    document.getElementById('total_collatoral').innerHTML = 'Total Collatoral: ' + Math.round(total_collateral_value_in_eth*100)/100 + ' ETH';
					    document.getElementById('total_borrow').innerHTML = 'Total Borrow: ' + Math.round(total_borrow_value_in_eth*100)/100 + ' ETH';


					    console.log(supplyToken);
					    console.log(borrowToken);
					  }
					  
					})().catch(console.error);					
				}

			</script>

	</body>
</html>